# 代码审查指南

本文档提供代码审查的详细指南和最佳实践。

## 审查流程

### 1. 准备阶段

在开始审查前：
- [ ] 阅读 PR 描述，了解变更内容
- [ ] 查看相关 Issue（如有）
- [ ] 了解上下文和业务需求

### 2. 快速扫描

快速浏览代码，检查：
- [ ] 是否有明显的错误
- [ ] 是否符合项目结构
- [ ] 是否有安全风险

### 3. 规范检查

使用检查清单逐项检查：
- [ ] 页面骨架（Skeleton）
- [ ] 数据加载状态（Loading）
- [ ] 按钮防抖（Debounce）
- [ ] 表单校验（Form Validation）

### 4. 代码质量

检查代码质量：
- [ ] TypeScript 类型定义
- [ ] 错误处理
- [ ] 性能优化
- [ ] 代码可读性

### 5. 测试检查

检查测试相关：
- [ ] 是否有测试覆盖
- [ ] 测试是否通过
- [ ] 边界情况是否考虑

## 审查重点

### 页面骨架（Skeleton）

**检查点**：
1. 列表页面是否有 Skeleton？
2. Skeleton 的条件判断是否正确？
3. 是否只在数据为空时显示？

**常见问题**：
- ❌ 缺少 Skeleton
- ❌ 条件判断错误（应该 `loading && data.length === 0`）
- ❌ 已有数据时也显示 Skeleton

### 数据加载状态（Loading）

**检查点**：
1. 异步操作是否有 loading 状态？
2. loading 状态是否正确管理？
3. 是否使用 try-finally 确保重置？

**常见问题**：
- ❌ 缺少 loading 状态
- ❌ 错误时 loading 状态未重置
- ❌ 按钮没有显示 loading 属性

### 按钮防抖（Debounce）

**检查点**：
1. 保存/查询/刷新按钮是否使用防抖？
2. 是否使用 `useDebounce` Hook？
3. 防抖时间是否合适？

**常见问题**：
- ❌ 没有防抖
- ❌ 使用旧的 `debounce` 工具函数
- ❌ 防抖时间不合适

### 表单校验（Form Validation）

**检查点**：
1. 必填字段是否有校验？
2. 是否使用 `formRules`？
3. 错误提示是否清晰？

**常见问题**：
- ❌ 缺少必填校验
- ❌ 使用内联规则而不是 `formRules`
- ❌ 错误提示不清晰

## 审查工具

### 自动化检查

使用检查脚本快速发现问题：

```bash
# 检查单个文件
npm run check:standards src/pages/User/UserList.tsx

# 或直接使用 node
node scripts/check-code-standards.js src/pages/User/UserList.tsx
```

### 检查清单

使用 [PR_REVIEW_CHECKLIST.md](./PR_REVIEW_CHECKLIST.md) 逐项检查。

## 审查评论

### 评论类型

1. **必须修复**（Must Fix）
   - 严重错误
   - 安全风险
   - 不符合规范

2. **建议改进**（Should Improve）
   - 代码质量
   - 性能优化
   - 可读性

3. **可选优化**（Nice to Have）
   - 代码风格
   - 文档完善
   - 额外功能

### 评论模板

```markdown
## 代码审查

### ✅ 符合规范
- [x] 页面骨架（Skeleton）
- [x] 数据加载状态（Loading）
- [x] 按钮防抖（Debounce）
- [x] 表单校验（Form Validation）

### ⚠️ 必须修复
- [ ] 第 315 行：保存按钮缺少防抖处理
- [ ] 第 106 行：用户名字段缺少必填校验

### 💡 建议改进
- 可以考虑使用 useMemo 优化性能
- 错误处理可以更详细

### 📝 可选优化
- 可以添加更多注释
- 可以考虑提取公共逻辑
```

## 审查最佳实践

### 1. 保持友好

- 使用友好的语气
- 提供建设性建议
- 解释为什么需要修改

### 2. 及时反馈

- 尽快开始审查
- 及时回复评论
- 保持沟通

### 3. 关注重点

- 优先检查规范和安全性
- 不要过度关注代码风格
- 尊重开发者的选择

### 4. 学习机会

- 将审查作为学习机会
- 分享最佳实践
- 帮助团队成长

## 常见问题

### Q1: 如何判断是否需要 Skeleton？

**A**: 所有列表页面（Table、Tree、List）在首次加载时都需要 Skeleton。

### Q2: 防抖时间如何选择？

**A**: 
- 保存/提交：300ms
- 查询/搜索：500ms
- 刷新：300ms

### Q3: 什么时候需要表单校验？

**A**: 所有表单字段都应该有适当的校验，特别是必填字段。

### Q4: 如何平衡审查严格度和效率？

**A**: 
- 使用自动化工具快速检查
- 重点关注规范和安全性
- 代码风格可以放宽要求

## 相关文档

- [PR 审查检查清单](./PR_REVIEW_CHECKLIST.md)
- [前端开发规范](./FRONTEND_DEVELOPMENT_GUIDE.md)
- [快速参考指南](./FRONTEND_QUICK_REFERENCE.md)

