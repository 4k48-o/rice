# E2E æµ‹è¯•è¯´æ˜

## æµ‹è¯•æ–‡ä»¶ç»“æ„

```
e2e/
â”œâ”€â”€ tests/              # æµ‹è¯•ç”¨ä¾‹
â”‚   â”œâ”€â”€ auth.spec.ts           # è®¤è¯ç›¸å…³æµ‹è¯•
â”‚   â”œâ”€â”€ user-management.spec.ts # ç”¨æˆ·ç®¡ç†æµ‹è¯•
â”‚   â”œâ”€â”€ department-management.spec.ts # éƒ¨é—¨ç®¡ç†æµ‹è¯•
â”‚   â”œâ”€â”€ navigation.spec.ts      # å¯¼èˆªåŠŸèƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ error-messages.spec.ts  # é”™è¯¯æ¶ˆæ¯å±•ç¤ºå’Œå›½é™…åŒ–æµ‹è¯•
â”‚   â”œâ”€â”€ example.spec.ts         # ç¤ºä¾‹æµ‹è¯•
â”‚   â””â”€â”€ README.md              # æœ¬æ–‡ä»¶
â””â”€â”€ fixtures/           # æµ‹è¯•è¾…åŠ©å‡½æ•°
    â””â”€â”€ auth.ts         # è®¤è¯ç›¸å…³è¾…åŠ©å‡½æ•°
```

## è¿è¡Œæµ‹è¯•

### å‰ç½®æ¡ä»¶

1. **å¯åŠ¨åç«¯æœåŠ¡**
   ```bash
   cd backend
   python -m uvicorn app.main:app --reload
   ```

2. **å¯åŠ¨å‰ç«¯æœåŠ¡**
   ```bash
   cd frontend
   npm run dev
   ```

3. **å®‰è£… Playwright æµè§ˆå™¨**ï¼ˆé¦–æ¬¡è¿è¡Œï¼‰
   ```bash
   npx playwright install
   ```

### è¿è¡Œå‘½ä»¤

```bash
# è¿è¡Œæ‰€æœ‰ E2E æµ‹è¯•
npm run test:e2e

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
npx playwright test e2e/tests/auth.spec.ts

# è¿è¡Œæµ‹è¯•å¹¶æ‰“å¼€ UI
npm run test:e2e:ui

# è°ƒè¯•æ¨¡å¼
npm run test:e2e:debug

# åœ¨ç‰¹å®šæµè§ˆå™¨ä¸­è¿è¡Œ
npx playwright test --project=chromium
```

## æµ‹è¯•æ•°æ®è¦æ±‚

### é»˜è®¤æµ‹è¯•è´¦å·

- **ç”¨æˆ·å**: `admin`
- **å¯†ç **: `admin123`

> âš ï¸ æ³¨æ„ï¼šè¯·ç¡®ä¿åç«¯æœ‰å¯¹åº”çš„æµ‹è¯•è´¦å·ï¼Œæˆ–è€…ä¿®æ”¹æµ‹è¯•ä¸­çš„ç™»å½•å‡­æ®ã€‚

### æµ‹è¯•æ•°æ®å‡†å¤‡

è¿è¡Œæµ‹è¯•å‰ï¼Œå»ºè®®å‡†å¤‡ä»¥ä¸‹æµ‹è¯•æ•°æ®ï¼š

1. **ç”¨æˆ·æ•°æ®**ï¼šè‡³å°‘æœ‰ä¸€ä¸ªæµ‹è¯•ç”¨æˆ·
2. **éƒ¨é—¨æ•°æ®**ï¼šè‡³å°‘æœ‰ä¸€ä¸ªæµ‹è¯•éƒ¨é—¨
3. **è§’è‰²æ•°æ®**ï¼šè‡³å°‘æœ‰ä¸€ä¸ªæµ‹è¯•è§’è‰²

## æµ‹è¯•è¦†ç›–èŒƒå›´

### âœ… å·²å®ç°çš„æµ‹è¯•

- [x] ç™»å½•åŠŸèƒ½æµ‹è¯•
- [x] ç”¨æˆ·ç®¡ç†é¡µé¢æµ‹è¯•
- [x] éƒ¨é—¨ç®¡ç†é¡µé¢æµ‹è¯•
- [x] å¯¼èˆªåŠŸèƒ½æµ‹è¯•
- [x] è¡¨å•æ“ä½œæµ‹è¯•
- [x] è¡¨å•æ ¡éªŒæµ‹è¯•
- [x] **é”™è¯¯æ¶ˆæ¯å±•ç¤ºæµ‹è¯•**ï¼ˆæ–°å¢ï¼‰
- [x] **å›½é™…åŒ–æµ‹è¯•**ï¼ˆæ–°å¢ï¼‰

### ğŸ“‹ å¾…å®ç°çš„æµ‹è¯•

- [ ] è§’è‰²ç®¡ç†å®Œæ•´æµç¨‹
- [ ] èœå•ç®¡ç†å®Œæ•´æµç¨‹
- [ ] æƒé™éªŒè¯æµ‹è¯•
- [ ] å“åº”å¼å¸ƒå±€æµ‹è¯•

## æ–°å¢æµ‹è¯•è¯´æ˜

### é”™è¯¯æ¶ˆæ¯å±•ç¤ºæµ‹è¯• (`error-messages.spec.ts`)

æµ‹è¯•é”™è¯¯æ¶ˆæ¯çš„æ­£ç¡®æ˜¾ç¤ºï¼ŒåŒ…æ‹¬ï¼š

1. **ä¸šåŠ¡é”™è¯¯æ¶ˆæ¯**
   - é‡å¤æ‰‹æœºå·é”™è¯¯æ¶ˆæ¯
   - é‡å¤é‚®ç®±é”™è¯¯æ¶ˆæ¯
   - é”™è¯¯æ¶ˆæ¯ä¸é‡å¤æ˜¾ç¤º

2. **å›½é™…åŒ–æµ‹è¯•**
   - ä¸­æ–‡ç¯å¢ƒä¸‹æ˜¾ç¤ºä¸­æ–‡é”™è¯¯æ¶ˆæ¯
   - è‹±æ–‡ç¯å¢ƒä¸‹æ˜¾ç¤ºè‹±æ–‡é”™è¯¯æ¶ˆæ¯
   - åˆ‡æ¢è¯­è¨€åé”™è¯¯æ¶ˆæ¯æ›´æ–°
   - ä¸šåŠ¡é”™è¯¯æ¶ˆæ¯æ”¯æŒå›½é™…åŒ–

3. **è¡¨å•æ ¡éªŒé”™è¯¯æ¶ˆæ¯**
   - é‚®ç®±æ ¼å¼é”™è¯¯æ¶ˆæ¯
   - æ‰‹æœºå·æ ¼å¼é”™è¯¯æ¶ˆæ¯
   - å¿…å¡«å­—æ®µé”™è¯¯æ¶ˆæ¯

## ç¼–å†™æ–°æµ‹è¯•

### 1. åˆ›å»ºæµ‹è¯•æ–‡ä»¶

åœ¨ `e2e/tests/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„ `.spec.ts` æ–‡ä»¶ï¼š

```typescript
import { test, expect } from '@playwright/test';
import { login } from '../fixtures/auth';

test.describe('åŠŸèƒ½åç§°', () => {
  test.beforeEach(async ({ page }) => {
    await login(page);
  });

  test('åº”è¯¥èƒ½å¤Ÿæ‰§è¡ŒæŸä¸ªæ“ä½œ', async ({ page }) => {
    // æµ‹è¯•ä»£ç 
  });
});
```

### 2. ä½¿ç”¨è¾…åŠ©å‡½æ•°

ä» `fixtures/` ç›®å½•å¯¼å…¥è¾…åŠ©å‡½æ•°ï¼š

```typescript
import { login, logout } from '../fixtures/auth';
```

### 3. æœ€ä½³å®è·µ

- **ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°**ï¼šæ¸…æ¥šè¯´æ˜æµ‹è¯•çš„ç›®çš„
- **ä½¿ç”¨ `beforeEach` è®¾ç½®æµ‹è¯•ç¯å¢ƒ**ï¼šç¡®ä¿æ¯ä¸ªæµ‹è¯•ä»å¹²å‡€çŠ¶æ€å¼€å§‹
- **ç­‰å¾…å…ƒç´ åŠ è½½**ï¼šä½¿ç”¨ `waitForSelector` ç­‰å¾…å¼‚æ­¥å†…å®¹
- **ä½¿ç”¨çµæ´»çš„é€‰æ‹©å™¨**ï¼šè€ƒè™‘å›½é™…åŒ–ï¼Œä½¿ç”¨å¤šç§å¯èƒ½çš„é€‰æ‹©å™¨
- **å¤„ç†å¯é€‰å…ƒç´ **ï¼šä½¿ç”¨ `isVisible().catch(() => false)` æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨

## è°ƒè¯•æŠ€å·§

### 1. ä½¿ç”¨ Playwright Inspector

```bash
npm run test:e2e:debug
```

### 2. æ·»åŠ æ–­ç‚¹

åœ¨æµ‹è¯•ä»£ç ä¸­æ·»åŠ ï¼š
```typescript
await page.pause();
```

### 3. æˆªå›¾å’Œè§†é¢‘

æµ‹è¯•å¤±è´¥æ—¶ä¼šè‡ªåŠ¨æˆªå›¾å’Œå½•åˆ¶è§†é¢‘ï¼ŒæŸ¥çœ‹ `test-results/` ç›®å½•ã€‚

### 4. æ…¢é€Ÿæ‰§è¡Œ

```bash
npx playwright test --slow-mo=1000
```

## å¸¸è§é—®é¢˜

### Q: æµ‹è¯•å¤±è´¥ï¼Œæç¤ºæ‰¾ä¸åˆ°å…ƒç´ ï¼Ÿ

A: 
1. æ£€æŸ¥é€‰æ‹©å™¨æ˜¯å¦æ­£ç¡®
2. å¢åŠ ç­‰å¾…æ—¶é—´ï¼š`await page.waitForTimeout(2000)`
3. ä½¿ç”¨æ›´é€šç”¨çš„é€‰æ‹©å™¨
4. æ£€æŸ¥é¡µé¢æ˜¯å¦å®Œå…¨åŠ è½½

### Q: ç™»å½•å¤±è´¥ï¼Ÿ

A:
1. ç¡®è®¤åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ
2. æ£€æŸ¥æµ‹è¯•è´¦å·æ˜¯å¦å­˜åœ¨
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

### Q: æµ‹è¯•è¿è¡Œå¾ˆæ…¢ï¼Ÿ

A:
1. å‡å°‘ä¸å¿…è¦çš„ç­‰å¾…æ—¶é—´
2. ä½¿ç”¨ `waitForLoadState('networkidle')` æ›¿ä»£å›ºå®šå»¶è¿Ÿ
3. å¹¶è¡Œè¿è¡Œæµ‹è¯•ï¼š`npx playwright test --workers=4`

## æŒç»­é›†æˆ

åœ¨ CI/CD ä¸­è¿è¡Œæµ‹è¯•ï¼š

```yaml
- name: Install dependencies
  run: npm ci

- name: Install Playwright Browsers
  run: npx playwright install --with-deps

- name: Run E2E tests
  run: npm run test:e2e
```

